# A TRIER

### Affiliations

bibliometrix comprend des fonctions permettant d'extraire automatiquement les éléments d'affiliation distincts et les références mais ça fonctionne moyen (de fait il est déjà assez difficile d'en faire sens au niveau de l'export WOS...)

```{r affiliations}
aff=results$Affiliations %>%
  as_tibble() %>% 
  head(n=50)
reactable::reactable(aff)
```

Il est ainsi assez difficile de travailler sur les affiliations de manière "non dirigée"... Par exemple pour les publis Hervé et en filtrant pour garder les publis récentes (\>2005) on a déjà 34 affiliations formulées de manière différentes (tout est mélangé pour les différents auteurs des articles) et en fonction du champ l'info principale n'est pas toujours la même (ici pas de mention de EVS par ex.).

<!-- ```{r aff_piegay} -->

<!-- aff_piegay=tib_auteur %>%  -->

<!--   filter(AU=="PIEGAY H" & PY>2005) %>%  -->

<!--   select(affiliations) %>%  -->

<!--   unique() -->

<!-- reactable::reactable(aff_piegay) -->

<!-- ``` -->

Par contre on pourrait imaginer lister un certain nombre de structures (CNRS, EVS, LBBE, LEHNA, etc) et tenter de détecter à partir de cet ensemble quels auteurs/publis s'y rattachent...

### Financement

Des infos sont enregistrées dans la base de données WOS concernant les programmes de recherche et les sources de financement. On peut récupérer ces renseignements pour environ un tiers des documents. Si on veut s'en servir il y aura un peu de nettoyage à faire...

```{r funding}
if(!file.exists("data/data_trans/bibtib.RDS")){
    bib=bibtex::read.bib("data/savedrecs.bib")
    bibtib=tibble(WOS_ID=names(bib),
                  funding_text=NA,
                  funding_acknowledgement=NA)
    for(i in 1:length(bib)){
      biblist=unlist(bib[i])
      var_text=paste0(bibtib$WOS_ID[i],".funding-text")
      var_ackn=paste0(bibtib$WOS_ID[i],".funding-acknowledgement")
      if(var_text %in% names(biblist)){
        bibtib$funding_text[i]=biblist[[var_text]]
      }else{
        bibtib$funding_text[i]=NA
      }
      if(var_ackn %in% names(biblist)){
        bibtib$funding_acknowledgement[i]=biblist[[var_ackn]]
      }else{
        bibtib$funding_acknowledgement[i]=NA
      }
    }
    bibtib =bibtib %>% 
      mutate(funding_text=str_replace_all(funding_text,"\\{\\[\\}","[")) %>% 
      mutate(funding_acknowledgement=str_replace_all(funding_acknowledgement,"\\{\\[\\}","["))%>% 
      mutate(funding_text=str_replace_all(funding_text,"``|\\{''\\}|\\n","")) %>% 
      mutate(funding_acknowledgement=str_replace_all(funding_acknowledgement,"``|\\{''\\}|\\n",""))%>% 
      mutate(funding_text=str_replace_all(funding_text,"\\s+"," ")) %>% 
      mutate(funding_acknowledgement=str_replace_all(funding_acknowledgement,"\\s+"," "))
  saveRDS(bibtib,"data/data_trans/bibtib.RDS")
}
bibtib=readRDS("data/data_trans/bibtib.RDS")
```

```{r financeurs}
financeurs=bibtib %>% 
  filter(!is.na(funding_acknowledgement)) %>% 
  group_by(funding_acknowledgement) %>% 
  summarise(ndoc=n()) %>% 
  arrange(desc(ndoc))
reactable::reactable(financeurs,
                     filterable=TRUE)
```

```{r ZABR}
financeurs %>% 
  mutate(ZABR=str_detect(funding_acknowledgement,
                         "ZABR|Zone Atelier Bassin du Rh.ne|GRAIE|OHM|OSR")) %>% 
  group_by(ZABR) %>% 
  summarise(n=n())
```
