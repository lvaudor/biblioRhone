## Citation intra et inter-communautés

```{r citation_intra}
# community during period has cited ref *n* times
tib_doc_commus=tib_doc_commus %>% 
  mutate(period=case_when(PY<=2000~"1)before_2000",
                          PY>2000 & PY<=2011~"2)2001_2011",
                          PY>2011~ "3)after__2011")) %>% 
  mutate(period=as.factor(period))

docs=tib_doc_commus %>% 
  group_by(community,period) %>% 
  summarise(ndoc=n(),.groups="drop")
cites=tib_doc_CR %>%
  filter(!is.na(PY)) %>%
  left_join(tib_doc_commus %>% select(id_doc,community,period),
            by="id_doc",
            relationship="many-to-many") %>% 
  group_by(community,period, CR) %>%
  summarise(ncit=n(),.groups="drop") %>% 
  left_join(docs,by=c("community","period")) %>% 
  na.omit() %>% 
  tidyr::unite(col=name,community,period,sep="-",remove=FALSE)

# # community during period has cited *ncit* documents
# # community at the end of period had authored 
# # a cumulated number of docs *ndoc*
# nodes=cites %>% 
#   group_by(community,period) %>% 
#   summarise(nref=sum(n)) %>% 
#   ungroup() %>% 
#   left_join(ndoc) %>% 
# 
# # community during period has cited: 
# #        - a total of *ntotref* documents
# #        - documents authored by community_cited *n* times
# # The proportion of references authored by community_cited
# # among all references is *prop*
# edges=cites %>% 
#   left_join(tib_doc %>% select(id_doc,community_cited=community),
#             by=c("ref"="id_doc")) %>% 
#   group_by(period,community) %>% 
#   mutate(ntotref=n()) %>% 
#   ungroup() %>% 
#   group_by(period,community,community_cited,ntotref)%>%
#   summarise(n=sum(n)) %>%
#   mutate(prop=n/ntotref*100) %>% 
#   na.omit() %>% 
#   ungroup() %>% 
#   tidyr::unite(col=from,community,period,sep="-",remove=FALSE) %>% 
#   tidyr::unite(col=to,community_cited,period,sep="-",remove=FALSE)
# 
# # The graph layout is calculated according to all citation links,
# # regardless of period
# edges_tot=edges %>% 
#   group_by(community_cited,community) %>% 
#   summarise(ntot=sum(n))
# set.seed(1234)
# coords=igraph::layout_with_fr(igraph::graph_from_data_frame(edges_tot)) %>% 
#   as_tibble() %>% 
#   setNames(c("x","y")) %>% 
#   mutate(community=paste0("c",str_pad(1:n(),pad="0",width=2)))
# 
# 
# edges=edges %>% 
#   mutate(loop=community==community_cited) %>% 
#   mutate(from=case_when(loop~paste0(from,"-copy"),
#                         !loop~from))
# 
# nodes=nodes %>% 
#   left_join(coords) 
# nodes=nodes %>%
#   mutate(loop=FALSE) %>% 
#   bind_rows(nodes %>%
#               mutate(loop=TRUE,
#                      name=paste0(name,"-copy"),
#                      y=y-0.6)) 
# 
# # create graph
# pcit=tidygraph::tbl_graph(nodes=nodes,
#                            edges=edges)
# 

```

```{r show_citation_intra,fig.height=8,fig.width=7}
#| label: Citation entre les communautés au cours du temps
#| fig-cap: "citations"
#plot graph
# ggraph(pcit,nodes)+
# geom_edge_fan(aes(edge_width=prop,color=community_cited,alpha=prop),
#                 arrow=arrow(length=unit(0.15,"inches"),
#                             angle=15),
#                 end_cap = circle(4, 'mm'),
#                 start_cap = circle(4, 'mm'))+
#   geom_node_point(data=nodes %>% filter(!loop),
#                   aes(fill=community,size=ndoc), alpha=0.5,shape=22)+
#   geom_node_text(data=nodes %>% filter(!loop),
#                  aes(label=community))+
#   facet_wrap(facets=vars(period),nrow=3)+
#   scale_size_continuous(range=c(1,20))+
#   scale_x_continuous()+
#   scale_y_continuous()+
#   guides(color=FALSE)
```

Les **noeuds** de ce graphe représentent les **documents du corpus écrits par la communauté d'auteurs ClX** au cours d'une période. La **taille** des noeuds correspond au **nombre total de documents écrits entre 1947 et la fin de la période considérée**. Ces documents s'appuient sur des références bibliographiques dont une partie *prop* correspond à des **documents écrits par des membres de la communauté elle-même** (flèches verticales) ou **d'autres communautés** (flèches pointant vers ces autres communautés). Remarque: on prend en compte le nombre d'occurrence des documents et non le nombre de documents distincts. La proportion est représentée par l'épaisseur et l'opacité des flèches.
